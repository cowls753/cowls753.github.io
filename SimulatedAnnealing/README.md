# Simulated Annealing     
     
     
모의 담금질 (Simulated Annealing) 기법은 높은 온도에서 액체 상태인 물질이 온도가 
점차 낮아지면서 결정체로 변하는 과정을 모방한 해 탐색 알고리즘이다.
     
용융 상태에서 물질 분자가 자유로이 움직이는 것을 모방해, 해 탐색 과정도 특정한 
패턴 없이 이루어진다.     

그러나, 온도가 점차 낮아지며 분자의 움직임이 줄어드는 것과 같이 해 탐색 과정 또한 
점차 규칙적인 방식으로 이루어진다.     

![KakaoTalk_20210610_152109505](https://user-images.githubusercontent.com/80511210/121474876-a8287800-c9ff-11eb-9d58-ffefbe0a5227.jpg)
     
     
모의 담금질 기법의 특징은 확률개념을 도입하여 현재 해의 이웃해 중에서 보다 **나쁜 
해**로 이동하는 자유로움을 보인다는 것이다.     

해가 될 수 있는 후보해들의 집합 **T**에 대해서 **T**가 점차 낮아질수록 나쁜 해로
이동하는 확률 또한 점차 작아진다.     
     
     
모의 담금질 기법을 이용해 함수의 최적해를 찾는 알고리즘을 설계해보자.     
     
     
     
-------
     
+ 입력값 : 함수의 최고차항 `n`, 각 항의 계수 `a[i]`, 탐색할 범위 `lower`, `upper`
+ 출력값 : 함수의 최적해
     
(추가적으로 탐색 과정을 알아보기 위해 탐색한 현재 해들을 순서대로 출력해보았다.)     

```java
for (int i=0; i<niter; i++) {
            int kt = (int) t;
            for(int j=0; j<kt; j++) {
                double x1 = r.nextDouble() * (upper - lower) + lower;    //범위 내에서 랜덤한 수 x1
                double f1 = p.fit(x1);

                if(p.isNeighborBetter(f0, f1)) {    //f0이 f1 보다 우수해일 경우
                    x0 = x1;
                    f0 = f1;
                    hist.add(f0);
                } else {      //f1이 f0 보다 우수해일 경우
                    double d = Math.sqrt(Math.abs(f1 - f0));
                    double p0 = Math.exp(-d/t);      //탐색이 자유로워질 확률 p
                    if(r.nextDouble() < p0 * 0.001) {     //0~1의 수가 확률 p내에 들 경우 (임의로 0.001 곱해줌)
                        x0 = x1;
                        f0 = f1;
                        hist.add(f0);     //나쁜 이웃해로 탐색
                    }
                }
            }
            t *= a;
        }
```

`f0`는 초기해이며, `f1`은 랜덤하게 정한 이웃해이다.     
두 값을 비교하여 둘 중 더욱 우수한 해를 탐색하도록 한다.    
     
한편, `t`의 범위를 점차 좁혀가며 `t`가 탐색이 자유로워질 확률 즉, 나쁜 이웃해로 탐색할 
확률 `p`에 영향을 주도록 한다.     
여기서 `p`는 `t`가 클수록, 두 해 `f0`와 `f1`의 거리가 가까울수록(`d`가 작을수록) 큰 값을 가진다.     
     
위와 같은 방식을 충분히 많이 반복하며 더 이상 우수한 해를 찾지 못할 때 반복을 종료한다.     
     
     

-------

## Parameter Estimination
     
구현한 모의담금질 기법을 이용해 독립변수에 따른 종속변수 데이터의 parameter를 추정해보자.     
     
parameter 추정을 진행하기 위해 선정한 데이터는 월별 평균 기온 데이터이다.     
![제목 없음](https://user-images.githubusercontent.com/80511210/121530150-1721c300-ca38-11eb-8884-4169deb6e6b0.png)
![그래프](https://user-images.githubusercontent.com/80511210/121530164-1be67700-ca38-11eb-98ad-436b419ee8f8.jpg)     
1월부터 12월까지의 평균 기온 데이터와 이 데이터의 분포를 나타낸 그래프이다.     
     
     
데이터의 그래프가 2차 함수의 그래프와 유사한 모양이므로, 비선형 모델 **ax²+bx+c**를 선정하였고, 
이에 적합한 a, b, c의 값을 찾기 위해 모의담금질 알고리즘을 활용하였다.    
     
앞서 구현한 함수의 최적해를 찾는 모의담금질 기법 알고리즘을 수정해 각 데이터 값에 대해 
오차가 가장 적게 나타나는 해인 a, b, c를 탐색하였다.     
![parameter esti](https://user-images.githubusercontent.com/80511210/121548470-ffead180-ca47-11eb-81d2-c2b0774d9576.png)     
해를 탐색할 범위를 -100부터 100까지로 입력해주었다.     
오차를 최소로 하는 해 a, b, c가 순서대로 출력되었으며, 그 아랫줄은 x가 1부터 12까지일 때, 
각 데이터와의 오차를 모두 더한 값이다.     
     
모의담금질 기법 알고리즘을 이용한 parameter 추정으로 월별 평균 기온의 비선형 모델 **ax²+bx+c**를 
**-0.45x²+7.62x-19.38**으로 선정하였다.     
     
     

-------

## Performance Analysis
     
![비교그래프](https://user-images.githubusercontent.com/80511210/121551118-52c58880-ca4a-11eb-86e2-1bd371b8dbb9.jpg)    
월별 평균 기온 데이터를 나타낸 그래프에 parameter 추정을 진행한 2차 함수 값의 분포를 
함께 나타내었다.    

해당 데이터는 2차 함수로 정확히 표현되지 않기 때문에 어느 정도의 오차를 포함한다.     
추정한 2차 함수와 월별 평균 기온 데이터의 평균 오차는 **11.8**이다.      
데이터가 정확히 2차 함수로 표현되지 않음에서 생기는 오차를 감안하더라도 상당히 
큰 오차라 생각된다.     
또한 parameter 추정 알고리즘을 반복적으로 실행시켰을 때, 최적해로 얻어지는 a, b, c의
값에 대해서도 일정하게 나타나지 않았다.     
     
이는 해당 알고리즘이 parameter 추정 알고리즘으로서 미흡한 점들이 있다는 것을 확인시켜준다.     
최적해를 찾는 정확성을 높이기 위해 반복횟수를 늘리거나, 이웃해를 선택하는 방식을 
다르게 하는 방법 등을 택할 수 있다. 이처럼 모의담금질 기법 알고리즘의 결과 정확도와 성능은 
반복 횟수, 이웃해 선택 방법, 냉각율, 탐색 범위 등을 어떻게 지정하느냐에 따라 크게 
달라질 수 있다는 점을 확인하였다.